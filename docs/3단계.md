# 3ë‹¨ê³„: API Gateway êµ¬í˜„

## ìš”êµ¬ì‚¬í•­

### ê¸°ë³¸ ì„¤ì •
- **í¬íŠ¸**: `8080`
- **ê²Œì´íŠ¸ì›¨ì´**: Spring Cloud Gateway
- **Base URL**: `/api`
- **ë¡œë“œë°¸ëŸ°ì‹±**: Round Robin (ê¸°ë³¸ê°’)

### í”„ë¡œì íŠ¸ êµ¬ì¡°
```
gateway-service/
â”œâ”€â”€ src/main/java/
â”‚   â””â”€â”€ com/example/gateway/
â”‚       â”œâ”€â”€ GatewayApplication.java
â”‚       â”œâ”€â”€ config/
â”‚       â”‚   â””â”€â”€ GatewayConfig.java
â”‚       â””â”€â”€ filter/
â”‚           â””â”€â”€ LoggingFilter.java
â”œâ”€â”€ src/main/resources/
â”‚   â””â”€â”€ application.yml
â”œâ”€â”€ build.gradle
â””â”€â”€ settings.gradle
```

### ì˜ì¡´ì„± ì„¤ì •
`build.gradle`ì— ì¶”ê°€í•´ì•¼ í•  ì£¼ìš” ì˜ì¡´ì„±:
```gradle
dependencies {
    implementation 'org.springframework.cloud:spring-cloud-starter-gateway'
    implementation 'org.springframework.cloud:spring-cloud-starter-loadbalancer'
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
}

dependencyManagement {
    imports {
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:2023.0.0"
    }
}
```

### ë¼ìš°íŒ… ê·œì¹™
êµ¬í˜„í•´ì•¼ í•  ì„œë¹„ìŠ¤ë³„ ë¼ìš°íŒ…:

| ì„œë¹„ìŠ¤ | ì›ë³¸ URL | ê²Œì´íŠ¸ì›¨ì´ URL | ëŒ€ìƒ í¬íŠ¸ |
|--------|----------|----------------|-----------|
| Product Service | `localhost:8082/api/products/**` | `localhost:8080/api/products/**` | 8082 |
| Order Service | `localhost:8083/api/orders/**` | `localhost:8080/api/orders/**` | 8083 |

### ì„¤ì • íŒŒì¼ (application.yml)
```yaml
server:
  port: 8080

spring:
  application:
    name: gateway-service
  cloud:
    gateway:
      routes:
        - id: product-service
          uri: http://localhost:8082
          predicates:
            - Path=/api/products/**
          filters:
            - StripPrefix=0
            
        - id: order-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/orders/**
          filters:
            - StripPrefix=0

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
```

### ì»¤ìŠ¤í…€ í•„í„° êµ¬í˜„
ë‹¤ìŒ ê¸°ëŠ¥ì„ ê°€ì§„ ê¸€ë¡œë²Œ í•„í„° êµ¬í˜„:

#### 1. ìš”ì²­ ë¡œê¹… í•„í„°
- ëª¨ë“  ìš”ì²­ì˜ URI, Method, Headers ë¡œê¹…
- ì‘ë‹µ ì‹œê°„ ì¸¡ì • ë° ë¡œê¹…
- ì‘ë‹µ ìƒíƒœ ì½”ë“œ ë¡œê¹…

#### 2. CORS ì„¤ì •
- ëª¨ë“  Origin í—ˆìš© (ê°œë°œí™˜ê²½)
- GET, POST, PUT, DELETE, OPTIONS ë©”ì„œë“œ í—ˆìš©
- Content-Type, Authorization í—¤ë” í—ˆìš©

### API í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

#### 1. ê¸°ë³¸ ë¼ìš°íŒ… í…ŒìŠ¤íŠ¸
```bash
# Product Service í…ŒìŠ¤íŠ¸
curl -X GET http://localhost:8080/api/products
curl -X GET http://localhost:8080/api/products/1

# Order Service í…ŒìŠ¤íŠ¸  
curl -X GET http://localhost:8080/api/orders
curl -X POST http://localhost:8080/api/orders \
  -H "Content-Type: application/json" \
  -d '{"productId": 1, "quantity": 2}'
```

#### 2. í†µí•© ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸
1. **ìƒí’ˆ ì¡°íšŒ**: `GET /api/products/1`
2. **ì£¼ë¬¸ ìƒì„±**: `POST /api/orders` (ìœ„ì—ì„œ ì¡°íšŒí•œ ìƒí’ˆìœ¼ë¡œ)
3. **ì£¼ë¬¸ ì¡°íšŒ**: `GET /api/orders/{id}`
4. **ì£¼ë¬¸ ì·¨ì†Œ**: `PUT /api/orders/{id}/cancel`

### í—¬ìŠ¤ì²´í¬ ë° ëª¨ë‹ˆí„°ë§

#### Actuator ì„¤ì •
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health, info, gateway
  endpoint:
    health:
      show-details: always
```

#### ê²Œì´íŠ¸ì›¨ì´ ìƒíƒœ í™•ì¸
- **í—¬ìŠ¤ì²´í¬**: `GET /actuator/health`
- **ë¼ìš°íŠ¸ ì •ë³´**: `GET /actuator/gateway/routes`
- **ê²Œì´íŠ¸ì›¨ì´ í•„í„°**: `GET /actuator/gateway/globalfilters`

### ë¶€í•˜ ë¶„ì‚° í…ŒìŠ¤íŠ¸

#### 1. ë™ì¼ ì„œë¹„ìŠ¤ ë‹¤ì¤‘ ì¸ìŠ¤í„´ìŠ¤ ì‹¤í–‰
```bash
# Product Serviceë¥¼ ë‹¤ë¥¸ í¬íŠ¸ë¡œ ì‹¤í–‰
./gradlew bootRun --args='--server.port=8082' &
./gradlew bootRun --args='--server.port=8084' &

# Order Serviceë¥¼ ë‹¤ë¥¸ í¬íŠ¸ë¡œ ì‹¤í–‰  
./gradlew bootRun --args='--server.port=8083' &
./gradlew bootRun --args='--server.port=8085' &
```

#### 2. ë¡œë“œë°¸ëŸ°ì‹± ì„¤ì • (ê³ ê¸‰)
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: product-service-lb
          uri: lb://product-service
          predicates:
            - Path=/api/products/**
    loadbalancer:
      ribbon:
        enabled: false
```

### ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒí™©

#### 1. ì„œë¹„ìŠ¤ ë‹¤ìš´ ì‹œë‚˜ë¦¬ì˜¤
- Product Service(8082) ì¤‘ë‹¨ í›„ ê²Œì´íŠ¸ì›¨ì´ ìš”ì²­ í…ŒìŠ¤íŠ¸
- ì ì ˆí•œ 5xx ì—ëŸ¬ ì‘ë‹µ í™•ì¸

#### 2. íƒ€ì„ì•„ì›ƒ ì„¤ì •
```yaml
spring:
  cloud:
    gateway:
      httpclient:
        connect-timeout: 1000
        response-timeout: 5000
```

### ì™„ë£Œ ê¸°ì¤€
- âœ… ê²Œì´íŠ¸ì›¨ì´ê°€ 8080 í¬íŠ¸ì—ì„œ ì •ìƒ ì‹¤í–‰
- âœ… Product Serviceì™€ Order Service ë¼ìš°íŒ… ë™ì‘
- âœ… ìš”ì²­ ë¡œê¹… í•„í„°ê°€ ì •ìƒ ì‘ë™
- âœ… CORS ì„¤ì •ì´ ì ìš©ë˜ì–´ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
- âœ… í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ë™ì‘
- âœ… í†µí•© ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸ í†µê³¼
- âœ… ì„œë¹„ìŠ¤ ë‹¤ìš´ ì‹œ ì ì ˆí•œ ì—ëŸ¬ ì‘ë‹µ

### ê³ ê¸‰ ê¸°ëŠ¥ (ì„ íƒì‚¬í•­)
- [ ] JWT ì¸ì¦ í•„í„° êµ¬í˜„
- [ ] Rate Limiting ì ìš©
- [ ] Circuit Breaker íŒ¨í„´ êµ¬í˜„
- [ ] ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

---

**íŒíŠ¸**:
- Spring Cloud GatewayëŠ” Reactive ê¸°ë°˜ì´ë¯€ë¡œ WebFlux ì‚¬ìš©
- í•„í„° ìˆœì„œê°€ ì¤‘ìš”í•©ë‹ˆë‹¤! `@Order` ì–´ë…¸í…Œì´ì…˜ í™œìš©
- Gradle ë©€í‹°ëª¨ë“ˆ í”„ë¡œì íŠ¸ êµ¬ì„± ì‹œ `settings.gradle`ì— ëª¨ë“  ëª¨ë“ˆ í¬í•¨
- `./gradlew bootRun`ìœ¼ë¡œ ê°œë°œ ì‹œ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

ì¤€ë¹„ë˜ë©´ ì‹œì‘í•´ë³´ì„¸ìš”! ğŸš€